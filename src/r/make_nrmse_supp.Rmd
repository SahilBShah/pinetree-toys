---
title: "nRMSE supplemental figure"
author: "Sahil Shah"
date: "9/2/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)
library(cowplot)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}

nrmse_ratios <- c(0.5002038733810914, 0.4984854031362939, 0.4717189300202526, 0.03286139689848213, 0.04466259779355728, 0.022548489894631128)
betas <- c(0.001, 0.01, 0.1, 1.0, 1.3, 2.0)
min_nrmse_ratios <- c(0.4924211388775092, 0.48789191944940097, 0.4228855721393035, 0.0, 0.0, 0.0)
max_nrmse_ratios <- c(0.5062410476775118, 0.504305977710233, 0.49453551912568305, 0.09433962264150944, 0.09302325581395349, 0.05660377358490566)

```

```{r}

df <- data.frame(betas, nrmse_ratios)
df$betas <- format(df$betas, scientific = FALSE)

nrmse_bar <- df %>% ggplot(aes(x=as.character(betas), y=nrmse_ratios)) + 
  geom_bar(stat='identity', fill="white", color="black", lwd=1.5) + 
  theme(legend.position="none",
        plot.margin = unit(c(2,2,2,2),"cm"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.text.x = element_text(size=105), 
        axis.text = element_text(size=105), 
        axis.line = element_line(size=1.3), 
        axis.ticks = element_line(size=1.3), 
        axis.ticks.length = unit(0.5, "cm"),
        axis.title = element_text(size=105)) + 
  xlab("Beta values") + 
  ylab("Fraction of deleterious accepted mutations") +
  scale_y_continuous(limits = c(0, 0.55), expand = c(0,0)) +
  geom_errorbar(aes(ymin=min_nrmse_ratios, ymax=max_nrmse_ratios), width=0.2, size=2)
nrmse_bar <- arrangeGrob(nrmse_bar, top=textGrob("B", x = unit(0.01, "npc"), y=unit(0.3, "npc"), just=c("left","top"), gp=gpar(col="black", font="bold", fontsize=140, fontfamily="Arial")))

```

```{r}

nrmse_plots <- list()

for(rep in c(107, 115, 130, 131, 145, 152)){
  if(rep == 107){
    beta <- "0.001"
  }else if(rep == 115){
    beta <- "0.010"
  }else if(rep==130){
    beta <- "0.100"
  }else if(rep == 131){
    beta <- "1.000"
  }else if(rep == 145){
    beta <- "1.300"
  }else if(rep == 152){
    beta <- "2.000"
  }
  
  nrmse <- read.table(paste0("../../results/nrmse_evaluation/paper_data1_rep", rep, "_nmut10/final/rmse_data.tsv"), 
                     header=TRUE)
  nrmse <- nrmse %>% filter(Accepted=='yes')
  if(!(5000 %in% nrmse$Iteration)){
    nrmse <- nrmse %>% add_row(Iteration=5000, NRMSE=nrmse$NRMSE[length(nrmse$NRMSE)], Accepted="yes")
  }
  if(rep != 152){
  nrmse_line_plot <- ggplot(nrmse, aes(x=Iteration, y=NRMSE)) + 
    geom_point(stat='identity', color='#D55E00', size=3) + 
    geom_line(size=2, stat='identity', color='#D55E00') + 
    theme(panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(), 
          panel.background = element_blank(), 
          plot.margin = unit(c(2,3,2,2), "cm"), 
          axis.text.y = element_text(size=75), 
          axis.text.x = element_blank(),
          axis.line.y = element_line(size=1.5), 
          axis.line.x = element_blank(),
          axis.ticks.y = element_line(size=1.5), 
          axis.ticks.x = element_blank(),
          axis.ticks.length = unit(0.5, "cm"),
          axis.title = element_blank(),
          legend.position = "none") +
    ylab("Root mean square error") +
    scale_y_continuous(limits = c(0, 3.5), expand = c(0, 0)) +
    scale_x_continuous(limits = c(0, 5100), expand = c(0, 0)) +
    panel_border()
  }else{
  nrmse_line_plot <- ggplot(nrmse, aes(x=Iteration, y=NRMSE)) +
    geom_point(stat='identity', color='#D55E00', size=3) + 
    geom_line(size=2, stat='identity', color='#D55E00') + 
    theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        plot.margin = unit(c(2,3,2,2), "cm"), 
        axis.text = element_text(size=75), 
        axis.line = element_line(size=1.8), 
        axis.ticks = element_line(size=1.8), 
        axis.ticks.length = unit(0.5, "cm"),
        axis.title.x = element_text(size=105),
        axis.title.y = element_blank(),
        legend.position = "none") +
  xlab("Generation") + 
  ylab("Root mean square error") +
  scale_y_continuous(limits = c(0, 3.5), expand = c(0, 0)) +
  scale_x_continuous(limits = c(0, 5100), expand = c(0, 0)) +
  panel_border()
  }
  
  nrmse_line_plot <- arrangeGrob(nrmse_line_plot, top=textGrob(paste0("beta = ", beta), 
                                                                  x = unit(0.82, "npc"), y=unit(0.3, "npc"),
                                                                  just=c("left","top"), 
                                                                  gp=gpar(col="black", font="bold", fontsize=70,
                                                                          fontfamily="Arial")))   

  
  nrmse_plots[[length(nrmse_plots) + 1]] <- nrmse_line_plot
}

```

## Including Plots

You can also embed plots, for example:

```{r}

rmse_supp <- grid.arrange(nrmse_plots[[1]], nrmse_plots[[2]], nrmse_plots[[3]], nrmse_plots[[4]], nrmse_plots[[5]], nrmse_plots[[6]], nrmse_bar, layout_matrix=cbind(c(1,2,3,4,5,6), c(7)), left=textGrob("Normalized RMSE", gp=gpar(fontsize=105), rot=90))
ggsave("../../manuscript_figures/si_figures/rmse_supplemental.png", rmse_supp, height=60, width=90, limitsize=FALSE, dpi=72)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
